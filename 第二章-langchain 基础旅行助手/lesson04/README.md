# ç¬¬å››è¯¾ï¼šAgent å·¥ä½œæµä¸å¤æ‚ä»»åŠ¡

## 1. å›é¡¾

ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†ï¼š
- ä½¿ç”¨ MemorySaver è®© Agent è®°ä½å¯¹è¯å†å²
- ä½¿ç”¨ thread_id åŒºåˆ†ä¸åŒå¯¹è¯
- å¤šè½®å¯¹è¯çš„å®ç°

æœ¬èŠ‚è¯¾æˆ‘ä»¬å°†è®© Agent å®Œæˆ **å¤šæ­¥éª¤å¤æ‚ä»»åŠ¡**ï¼

---

## 2. ä»€ä¹ˆæ˜¯å¤šæ­¥éª¤ä»»åŠ¡ï¼Ÿ

**ç®€å•ä»»åŠ¡**ï¼šä¸€ä¸ªå·¥å…·è°ƒç”¨å°±èƒ½å®Œæˆ
```
ç”¨æˆ·: åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
Agent: [è°ƒç”¨ get_weather] â†’ è¿”å›ç»“æœ
```

**å¤šæ­¥éª¤ä»»åŠ¡**ï¼šéœ€è¦å¤šä¸ªå·¥å…·åä½œå®Œæˆ
```
ç”¨æˆ·: å¸®æˆ‘è§„åˆ’ä¸€ä¸ªåŒ—äº¬åˆ°ä¸Šæµ·çš„å‡ºè¡Œè®¡åˆ’
Agent: 
  1. [è°ƒç”¨ get_weather("åŒ—äº¬")] â†’ è·å–å‡ºå‘åœ°å¤©æ°”
  2. [è°ƒç”¨ get_weather("ä¸Šæµ·")] â†’ è·å–ç›®çš„åœ°å¤©æ°”
  3. [è°ƒç”¨ get_current_time] â†’ è·å–å½“å‰æ—¶é—´
  4. [è°ƒç”¨ search_transport] â†’ æœç´¢äº¤é€šæ–¹å¼
  5. ç»¼åˆæ‰€æœ‰ä¿¡æ¯ï¼Œç”Ÿæˆå‡ºè¡Œå»ºè®®
```

---

## 3. è®¾è®¡å¤šæ­¥éª¤å·¥å…·é›†

ä¸ºäº†å®Œæˆå¤æ‚ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ç»„åä½œçš„å·¥å…·ï¼š

| å·¥å…· | åŠŸèƒ½ | ç”¨é€” |
|------|------|------|
| `get_weather` | æŸ¥è¯¢å¤©æ°” | äº†è§£ç©¿è¡£å»ºè®® |
| `get_current_time` | è·å–æ—¶é—´ | ç¡®å®šå‡ºå‘æ—¶é—´ |
| `search_attractions` | æœç´¢æ™¯ç‚¹ | è§„åˆ’æ¸¸ç©è·¯çº¿ |
| `estimate_travel_time` | ä¼°ç®—è¡Œç¨‹ | æ—¶é—´è§„åˆ’ |
| `create_plan` | ç”Ÿæˆè®¡åˆ’ | æ±‡æ€»è¾“å‡º |

---

## 4. ä»£ç å®æˆ˜

### 4.1 å®šä¹‰å·¥å…·é›†

```python
@tool
def get_weather(city: str) -> str:
    """æŸ¥è¯¢åŸå¸‚å¤©æ°”ï¼Œç”¨äºäº†è§£ç©¿è¡£å’Œå‡ºè¡Œå»ºè®®"""
    # ... è°ƒç”¨å¤©æ°” API

@tool
def get_current_time() -> str:
    """è·å–å½“å‰æ—¶é—´"""
    return datetime.now().strftime("%Y-%m-%d %H:%M:%S")

@tool
def search_attractions(city: str) -> str:
    """æœç´¢åŸå¸‚çš„çƒ­é—¨æ™¯ç‚¹"""
    attractions = {
        "åŒ—äº¬": "æ•…å®«ã€é•¿åŸã€é¢å’Œå›­ã€å¤©å›ã€å—é”£é¼“å··",
        "ä¸Šæµ·": "å¤–æ»©ã€ä¸œæ–¹æ˜ç ã€è±«å›­ã€å—äº¬è·¯ã€è¿ªå£«å°¼",
        "æ­å·": "è¥¿æ¹–ã€çµéšå¯ºã€å®‹åŸã€è¥¿æºªæ¹¿åœ°ã€åƒå²›æ¹–",
        "æˆéƒ½": "å®½çª„å··å­ã€é”¦é‡Œã€å¤§ç†ŠçŒ«åŸºåœ°ã€éƒ½æ±Ÿå °ã€é’åŸå±±",
    }
    return attractions.get(city, f"{city}æš‚æ— æ™¯ç‚¹ä¿¡æ¯")

@tool
def estimate_travel_time(from_city: str, to_city: str) -> str:
    """ä¼°ç®—ä¸¤ä¸ªåŸå¸‚ä¹‹é—´çš„äº¤é€šæ—¶é—´"""
    times = {
        ("åŒ—äº¬", "ä¸Šæµ·"): "é«˜é“çº¦4.5å°æ—¶ï¼Œé£æœºçº¦2å°æ—¶",
        ("ä¸Šæµ·", "æ­å·"): "é«˜é“çº¦1å°æ—¶ï¼Œè‡ªé©¾çº¦2å°æ—¶",
        ("åŒ—äº¬", "æ­å·"): "é«˜é“çº¦5å°æ—¶ï¼Œé£æœºçº¦2å°æ—¶",
        ("æˆéƒ½", "åŒ—äº¬"): "é«˜é“çº¦8å°æ—¶ï¼Œé£æœºçº¦2.5å°æ—¶",
    }
    key = (from_city, to_city)
    reverse_key = (to_city, from_city)
    return times.get(key) or times.get(reverse_key) or f"{from_city}åˆ°{to_city}çš„äº¤é€šä¿¡æ¯æš‚æ— "
```

### 4.2 è®© Agent å®Œæˆå¤æ‚ä»»åŠ¡

```python
# å¤æ‚ä»»åŠ¡ç¤ºä¾‹
question = """
æˆ‘æƒ³åœ¨æ˜¥èŠ‚æœŸé—´ä»åŒ—äº¬å»ä¸Šæµ·ç©3å¤©ï¼Œè¯·å¸®æˆ‘ï¼š
1. æŸ¥çœ‹ä¸¤åœ°å¤©æ°”
2. æ¨èä¸Šæµ·çš„æ™¯ç‚¹
3. ä¼°ç®—äº¤é€šæ—¶é—´
4. ç»™å‡ºä¸€ä¸ªç®€å•çš„å‡ºè¡Œå»ºè®®
"""

result = agent.invoke({"messages": [{"role": "user", "content": question}]})
```

---

## 5. è¿è¡Œæ•ˆæœ

```
============================================================
å¤æ‚ä»»åŠ¡ï¼šè§„åˆ’åŒ—äº¬åˆ°ä¸Šæµ·çš„å‡ºè¡Œ
============================================================

ç”¨æˆ·: æˆ‘æƒ³åœ¨æ˜¥èŠ‚æœŸé—´ä»åŒ—äº¬å»ä¸Šæµ·ç©3å¤©ï¼Œè¯·å¸®æˆ‘ï¼š
      1. æŸ¥çœ‹ä¸¤åœ°å¤©æ°”
      2. æ¨èä¸Šæµ·çš„æ™¯ç‚¹
      3. ä¼°ç®—äº¤é€šæ—¶é—´
      4. ç»™å‡ºä¸€ä¸ªç®€å•çš„å‡ºè¡Œå»ºè®®

ğŸ”§ å·¥å…·è°ƒç”¨:
   â†’ get_weather({'city': 'åŒ—äº¬'}) è¿”å›: åŒ—äº¬ï¼šæ™´ï¼Œæ¸©åº¦ 3Â°C
   â†’ get_weather({'city': 'ä¸Šæµ·'}) è¿”å›: ä¸Šæµ·ï¼šé˜´ï¼Œæ¸©åº¦ 8Â°C
   â†’ search_attractions({'city': 'ä¸Šæµ·'}) è¿”å›: å¤–æ»©ã€ä¸œæ–¹æ˜ç ã€è±«å›­ã€å—äº¬è·¯ã€è¿ªå£«å°¼
   â†’ estimate_travel_time({'from_city': 'åŒ—äº¬', 'to_city': 'ä¸Šæµ·'}) è¿”å›: é«˜é“çº¦4.5å°æ—¶ï¼Œé£æœºçº¦2å°æ—¶

Agent å›ç­”:
æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä¸ºæ‚¨æ•´ç†äº†ä»¥ä¸‹å‡ºè¡Œå»ºè®®ï¼š

## å¤©æ°”æƒ…å†µ
- åŒ—äº¬ï¼šæ™´å¤©ï¼Œ3Â°Cï¼Œè¾ƒå†·éœ€ç©¿åšå¤–å¥—
- ä¸Šæµ·ï¼šé˜´å¤©ï¼Œ8Â°Cï¼Œæ¸©åº¦é€‚ä¸­

## äº¤é€šå»ºè®®
- é«˜é“ï¼šçº¦4.5å°æ—¶ï¼Œæ¨èï¼èˆ’é€‚ä¸”ç­æ¬¡å¤š
- é£æœºï¼šçº¦2å°æ—¶ï¼Œé€‚åˆæ—¶é—´ç´§å¼ çš„æ—…å®¢

## ä¸Šæµ·æ™¯ç‚¹æ¨è
3å¤©è¡Œç¨‹å»ºè®®ï¼š
- Day 1ï¼šå¤–æ»© + å—äº¬è·¯æ­¥è¡Œè¡—
- Day 2ï¼šä¸œæ–¹æ˜ç  + è±«å›­
- Day 3ï¼šè¿ªå£«å°¼ä¹å›­

## ç©¿è¡£å»ºè®®
ä¸Šæµ·æ¯”åŒ—äº¬æš–å’Œ5åº¦ï¼Œä½†ä»éœ€æ³¨æ„ä¿æš–ï¼Œå»ºè®®æºå¸¦è–„ç¾½ç»’æœæˆ–åšå¤–å¥—ã€‚

ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼
```

---

## 6. Agent çš„æ¨ç†è¿‡ç¨‹

Agent è‡ªåŠ¨åˆ†è§£ä»»åŠ¡å¹¶æŒ‰é¡ºåºæ‰§è¡Œï¼š

```
ç”¨æˆ·éœ€æ±‚åˆ†æ
    â†“
1. éœ€è¦æŸ¥å¤©æ°” â†’ è°ƒç”¨ get_weather("åŒ—äº¬")
                 è°ƒç”¨ get_weather("ä¸Šæµ·")
    â†“
2. éœ€è¦æ™¯ç‚¹æ¨è â†’ è°ƒç”¨ search_attractions("ä¸Šæµ·")
    â†“
3. éœ€è¦äº¤é€šä¿¡æ¯ â†’ è°ƒç”¨ estimate_travel_time("åŒ—äº¬", "ä¸Šæµ·")
    â†“
4. æ±‡æ€»æ‰€æœ‰ä¿¡æ¯ï¼Œç”Ÿæˆå‡ºè¡Œå»ºè®®
```

---

## 7. å®Œæ•´ä»£ç 

```python
"""
ç¬¬å››è¯¾ï¼šAgent å·¥ä½œæµä¸å¤æ‚ä»»åŠ¡
è®© Agent å®Œæˆå¤šæ­¥éª¤çš„å¤æ‚ä»»åŠ¡
"""

import os
import time
import hashlib
import hmac
import base64
import requests
from urllib import parse
from datetime import datetime
from langchain_community.chat_models import ChatZhipuAI
from langchain_core.tools import tool
from langgraph.prebuilt import create_react_agent
from langgraph.checkpoint.memory import MemorySaver

# API é…ç½®
ZHIPU_API_KEY = os.getenv("ZHIPU_API_KEY")
SENIVERSE_UID = "Pc9Fuy4ms9vV1btnZ"
SENIVERSE_KEY = "S4KHevvOhFIYayLbu"

# åˆ›å»º LLM
llm = ChatZhipuAI(model="glm-4", api_key=ZHIPU_API_KEY, temperature=0.7)


@tool
def get_weather(city: str) -> str:
    """æŸ¥è¯¢åŸå¸‚å®æ—¶å¤©æ°”ï¼Œç”¨äºäº†è§£ç©¿è¡£å’Œå‡ºè¡Œå»ºè®®"""
    # ... å¤©æ°” API è°ƒç”¨ä»£ç 


@tool
def get_current_time() -> str:
    """è·å–å½“å‰æ—¶é—´"""
    return datetime.now().strftime("%Y-%m-%d %H:%M:%S")


@tool
def search_attractions(city: str) -> str:
    """æœç´¢åŸå¸‚çš„çƒ­é—¨æ™¯ç‚¹ï¼Œç”¨äºæ—…æ¸¸è§„åˆ’"""
    attractions = {
        "åŒ—äº¬": "æ•…å®«ã€é•¿åŸã€é¢å’Œå›­ã€å¤©å›ã€å—é”£é¼“å··",
        "ä¸Šæµ·": "å¤–æ»©ã€ä¸œæ–¹æ˜ç ã€è±«å›­ã€å—äº¬è·¯ã€è¿ªå£«å°¼",
        "æ­å·": "è¥¿æ¹–ã€çµéšå¯ºã€å®‹åŸã€è¥¿æºªæ¹¿åœ°ã€åƒå²›æ¹–",
        "æˆéƒ½": "å®½çª„å··å­ã€é”¦é‡Œã€å¤§ç†ŠçŒ«åŸºåœ°ã€éƒ½æ±Ÿå °ã€é’åŸå±±",
    }
    return attractions.get(city, f"{city}æš‚æ— æ™¯ç‚¹ä¿¡æ¯")


@tool
def estimate_travel_time(from_city: str, to_city: str) -> str:
    """ä¼°ç®—ä¸¤ä¸ªåŸå¸‚ä¹‹é—´çš„äº¤é€šæ—¶é—´å’Œæ–¹å¼"""
    times = {
        ("åŒ—äº¬", "ä¸Šæµ·"): "é«˜é“çº¦4.5å°æ—¶ï¼Œé£æœºçº¦2å°æ—¶",
        ("ä¸Šæµ·", "æ­å·"): "é«˜é“çº¦1å°æ—¶ï¼Œè‡ªé©¾çº¦2å°æ—¶",
        ("åŒ—äº¬", "æ­å·"): "é«˜é“çº¦5å°æ—¶ï¼Œé£æœºçº¦2å°æ—¶",
    }
    key = (from_city, to_city)
    reverse_key = (to_city, from_city)
    return times.get(key) or times.get(reverse_key) or f"{from_city}åˆ°{to_city}çš„äº¤é€šä¿¡æ¯æš‚æ— "


# ç»„åˆæ‰€æœ‰å·¥å…·
tools = [get_weather, get_current_time, search_attractions, estimate_travel_time]

# åˆ›å»ºå¸¦è®°å¿†çš„ Agent
memory = MemorySaver()
agent = create_react_agent(llm, tools, checkpointer=memory)

if __name__ == "__main__":
    config = {"configurable": {"thread_id": "travel-planner"}}
    
    question = """
    æˆ‘æƒ³åœ¨æ˜¥èŠ‚æœŸé—´ä»åŒ—äº¬å»ä¸Šæµ·ç©3å¤©ï¼Œè¯·å¸®æˆ‘ï¼š
    1. æŸ¥çœ‹ä¸¤åœ°å¤©æ°”
    2. æ¨èä¸Šæµ·çš„æ™¯ç‚¹
    3. ä¼°ç®—äº¤é€šæ—¶é—´
    4. ç»™å‡ºä¸€ä¸ªç®€å•çš„å‡ºè¡Œå»ºè®®
    """
    
    result = agent.invoke(
        {"messages": [{"role": "user", "content": question}]},
        config
    )
    print(result["messages"][-1].content)
```

---

## 8. è¯¾åç»ƒä¹ 

1. æ·»åŠ  `search_restaurants` å·¥å…·ï¼Œæ¨èå½“åœ°ç¾é£Ÿ
2. æ·»åŠ  `calculate_budget` å·¥å…·ï¼Œä¼°ç®—æ—…è¡Œé¢„ç®—
3. å°è¯•è®© Agent è§„åˆ’ä¸€ä¸ª"æˆéƒ½ 5 æ—¥æ¸¸"

---

## ä¸‹ä¸€è¯¾é¢„å‘Š

**ç¬¬äº”è¯¾ï¼šæ„å»ºå®Œæ•´çš„ Agent åº”ç”¨**
- æ·»åŠ  Web ç•Œé¢
- ç”¨æˆ·è¾“å…¥äº¤äº’
- éƒ¨ç½²ä¸Šçº¿
